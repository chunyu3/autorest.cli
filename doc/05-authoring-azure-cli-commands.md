# Generating Azure CLI Commands

## Prerequisites

- Python SDK is already generated
- Integration Tests for Python SDK are generated and validated
- Minimal **readme.cli.md** file is already in place

## Manual Generation

### Prepare Your Environment

The best way of using **autorest.cli** is Docker container.

You need to clone following directories locally. I have added Python SDK here as well, it's not necessary, but may be useful.

    git clone https://github.com/Azure/azure-rest-api-specs
    git clone https://github.com/Azure/azure-cli-extensions.git
    git clone https://github.com/Azure/azure-sdk-for-python.git
    git clone https://github.com/Azure/autorest.cli.git

For simplicity let's assume they are cloned under **c:\dev** directory on Windows machine.

The easiest way to use **autorest.cli** is the container:

    docker run -it --rm -v c:\dev:/_ mcr.microsoft.com/azure-cli/tools

>NOTE: In final solution it won't be necessary to clone Autorest CLI repository

### Generate Extension

Following command will generate default Azure CLI extension considering all ther prerequisites are in place

    autorest --cli --use=/_/autorest.cli --cli-module --extension --output-folder=/_/azure-cli-extensions /_/azure-rest-api-specs/specification/frontdoor/resource-manager/readme.md

### Add Local Copy of Python SDK

> NOTE: This step will be replaced by appropriate AutoRest command and performed automatically by CI in the future.

In your extension folder create a subfolder called **vendored_sdks** and copy appropriate subfolder from Python SDK.

For instance using **healthcareapis** as an example, your folder structure should look as follows:

    azure-cli-extensions
      src
        healthcareapis
          azext_healthcareapis
            vendored_sdks
              ------- HEALTHCARE APIS SDK ------
              healthcareapis
                models
                operations
                __init__.py
                _configuration.py
                _healthcareapis_managemenet_client.py
                version.py

## Running The Extension

To install the extesnion run:

    azdev extension add <your-extension-name>

Then you can verify that extension was installed correctly by running:

    az <your-extension-name> --help

and proceed with:

    az login

and testing all the examples.

## Running Integration Test

TBD

## Next Steps

### Changing Extension / Top Command Group Name

If extension name generated by default is not desired, just add following line to **readme.cli.md**:

  cli:
    ...
    group-name: my-extension-name
    ...

### Modelling Command Groups

TBD

### Disabling Command Groups

TBD

### Renaming Parameters

TBD

### Adjusting Documentation

TBD

### Disabling Paramaters

TBD

### Marking Options Non-Updatable

TBD

### Fixing Example Description / Name

Initially example names won't look very good, just like below **ManagedNetworksPut** is not a very good name/description:

    Examples
        ManagedNetworksPut
            az managednetwork create --resource-group "myResourceGroup" --name "myManagedNetwork" \
            --location "eastus"

In order to change this name, find name location in swagger specification:

        "x-ms-examples": {
          "ManagedNetworksPut": {
            "$ref": "./examples/ManagedNetwork/ManagedNetworksPut.json"
          }
        }

and change it to be more descriptive:

        "x-ms-examples": {
          "Create Managed Network": {
            "$ref": "./examples/ManagedNetwork/ManagedNetworksPut.json"
          }
        }


